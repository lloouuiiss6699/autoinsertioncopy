<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Autoinsertion U-Shaped Gallery (Tall Walls)</title>
  <script src="https://aframe.io/releases/1.5.0/aframe.min.js"></script>
  <style>
    body { margin: 0; overflow: hidden; }
    canvas.wall-canvas {
      position: absolute;
      left: -9999px;
      top: -9999px;
    }
  </style>
</head>
<body>

<a-scene background="color: #111">
  <!-- Lighting -->
  <a-entity light="type: ambient; color: #888"></a-entity>
  <a-entity light="type: directional; color: #fff; intensity: 0.8" position="0 6 6"></a-entity>
  <a-entity light="type: directional; color: #fff; intensity: 0.6" position="6 6 0"></a-entity>
  <a-entity light="type: directional; color: #fff; intensity: 0.6" position="-6 6 0"></a-entity>

  <!-- Camera -->
  <a-entity position="0 1.8 8">
    <a-camera look-controls></a-camera>
  </a-entity>

  <!-- Floor -->
  <a-plane rotation="-90 0 0" width="20" height="20" color="#222"></a-plane>

  <!-- U-shaped gallery walls (taller) -->
  <a-plane id="wall1" position="0 3 -5" rotation="0 0 0" width="10" height="6"></a-plane>
  <a-plane id="wall2" position="-5 3 0" rotation="0 90 0" width="10" height="6"></a-plane>
  <a-plane id="wall3" position="5 3 0" rotation="0 -90 0" width="10" height="6"></a-plane>
</a-scene>

<script>
const overlaySrc = 'mee.png'; // make sure mee.png is in the same folder
const wallIds = ['wall1','wall2','wall3'];

function getRandomImage() {
  const width = 500 + Math.floor(Math.random()*300);
  const height = 600 + Math.floor(Math.random()*200); // taller canvas
  return { src: `https://picsum.photos/${width}/${height}?random=${Math.random()}`, width, height };
}

function getRandomRotation() { return Math.random() * 30 - 15; }
function getRandomScale() { return 0.9 + Math.random() * 0.2; }

function createWallCollage(wallId) {
  const canvas = document.createElement('canvas');
  canvas.width = 800;
  canvas.height = 600; // taller to match wall
  canvas.className = 'wall-canvas';
  document.body.appendChild(canvas);

  const ctx = canvas.getContext('2d');
  ctx.fillStyle = '#111'; // placeholder
  ctx.fillRect(0,0,canvas.width,canvas.height);

  const wallEl = document.getElementById(wallId);
  wallEl.addEventListener('loaded', () => {
    wallEl.setAttribute('material','src',canvas);
    drawNextImage();
  });

  function drawNextImage() {
    const imgData = getRandomImage();
    const bg = new Image();
    bg.crossOrigin = "Anonymous";
    bg.src = imgData.src;

    bg.onload = () => {
      const scale = getRandomScale();
      const width = bg.naturalWidth * scale;
      const height = bg.naturalHeight * scale;

      const centerX = canvas.width / 2;
      const centerY = canvas.height / 2;
      const offsetX = Math.floor(Math.random() * 400 - 200);
      const offsetY = Math.floor(Math.random() * 300 - 150);
      const x = centerX + offsetX - width/2;
      const y = centerY + offsetY - height/2;

      // Draw background
      ctx.save();
      ctx.translate(x + width/2, y + height/2);
      ctx.rotate(getRandomRotation() * Math.PI/180);
      ctx.drawImage(bg, -width/2, -height/2, width, height);
      ctx.restore();

      // Draw overlay
      const overlay = new Image();
      overlay.src = overlaySrc;
      overlay.onload = () => {
        const overlayWidth = 120;
        const marginX = width*0.2;
        const marginY = height*0.2;
        const overlayMaxX = width - overlayWidth - 2*marginX;
        const overlayMaxY = height - overlayWidth - 2*marginY;
        const ox = x + marginX + Math.random()*overlayMaxX;
        const oy = y + marginY + Math.random()*overlayMaxY;

        ctx.save();
        ctx.translate(ox + overlayWidth/2, oy + overlayWidth/2);
        ctx.rotate(getRandomRotation() * Math.PI/180);
        ctx.drawImage(overlay, -overlayWidth/2, -overlayWidth/2, overlayWidth, overlayWidth);
        ctx.restore();

        const mesh = wallEl.getObject3D('mesh');
        if(mesh && mesh.material.map) {
          mesh.material.map.needsUpdate = true;
        }
      };

      setTimeout(drawNextImage, 1000 + Math.random()*300);
    };

    bg.onerror = () => setTimeout(drawNextImage, 500);
  }

  return canvas;
}

wallIds.forEach(id => createWallCollage(id));
</script>

</body>
</html>
